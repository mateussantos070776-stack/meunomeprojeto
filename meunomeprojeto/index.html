<style>
    /* Reset e Vari√°veis de Cores */
    :root {
        --bg-dark: #0a0a0a;
        --card-bg: #161616;
        --accent-blue: #007bff;
        --danger: #dc3545;
        --text-dim: #b3b3b3;
    }

    /* Layout do Painel ADM */
    #screen-adm-panel {
        width: 100vw;
        max-width: 1200px;
        height: 85vh;
        display: none; /* Inicialmente oculto */
        background: var(--card-bg);
        border: 1px solid #333;
        overflow: hidden;
        flex-direction: row;
        align-items: stretch;
    }

    .adm-sidebar {
        width: 250px;
        background: #000;
        border-right: 1px solid #333;
        display: flex;
        flex-direction: column;
        padding: 20px;
    }

    .adm-content {
        flex: 1;
        padding: 30px;
        overflow-y: auto;
        text-align: left;
    }

    .sidebar-btn {
        background: transparent;
        color: var(--text-dim);
        text-align: left;
        padding: 12px;
        margin: 5px 0;
        border-radius: 8px;
        font-size: 14px;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .sidebar-btn:hover, .sidebar-btn.active {
        background: var(--accent-blue);
        color: white;
    }

    /* Cards de Estat√≠sticas */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .stat-card {
        background: #222;
        padding: 20px;
        border-radius: 12px;
        border-left: 4px solid var(--accent-blue);
    }

    .stat-card h4 { margin: 0; font-size: 12px; color: var(--text-dim); text-transform: uppercase; }
    .stat-card p { margin: 10px 0 0; font-size: 24px; font-weight: bold; }

    /* Estilo do Chat Profissional */
    .chat-container {
        display: flex;
        flex-direction: column;
        height: 400px;
        background: #000;
        border-radius: 10px;
        border: 1px solid #333;
    }

    #chat-box-adm {
        flex: 1;
        padding: 15px;
        overflow-y: auto;
    }

    .msg-bubble {
        margin-bottom: 10px;
        padding: 8px 12px;
        border-radius: 8px;
        max-width: 80%;
        font-size: 14px;
    }

    .msg-adm { background: var(--accent-blue); align-self: flex-end; margin-left: auto; }
    .msg-membro { background: #333; }

    .adm-section { display: none; }
    .adm-section.active { display: block; }
</style>

<div id="screen-adm-login" class="screen">
    <div style="font-size: 40px; margin-bottom: 10px;">üîê</div>
    <h2>Portal Administrativo</h2>
    <p style="color: #666; font-size: 13px;">Insira suas credenciais de acesso</p>
    <input type="text" id="adm-user" placeholder="Usu√°rio">
    <input type="password" id="adm-pass" placeholder="Senha">
    <button class="btn-blue" onclick="checkAdm()">AUTENTICAR</button>
    <button class="btn-gray" onclick="location.reload()">VOLTAR AO IN√çCIO</button>
</div>

<div id="screen-adm-panel" class="screen">
    <div class="adm-sidebar">
        <h3 style="color: var(--accent-blue); font-size: 18px; margin-bottom: 30px;">KERIX ADM</h3>
        <button class="sidebar-btn active" onclick="switchAdmTab('tab-home')">üìä Dashboard</button>
        <button class="sidebar-btn" onclick="switchAdmTab('tab-gerador')">üîë Gerador de Acesso</button>
        <button class="sidebar-btn" onclick="switchAdmTab('tab-usuarios')">üë• Gest√£o de Usu√°rios</button>
        <button class="sidebar-btn" onclick="switchAdmTab('tab-chat')">üí¨ Central de Chat</button>
        <div style="margin-top: auto;">
            <button class="btn-red" style="padding: 10px;" onclick="location.reload()">Sair do Sistema</button>
        </div>
    </div>

    <div class="adm-content">
        
        <div id="tab-home" class="adm-section active">
            <h2>Vis√£o Geral</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <h4>Status do Sistema</h4>
                    <p style="color: #00ff00;">Online</p>
                </div>
                <div class="stat-card">
                    <h4>Usu√°rios Ativos</h4>
                    <p id="stat-user-count">0</p>
                </div>
                <div class="stat-card">
                    <h4>√öltimo Acesso</h4>
                    <p id="stat-last-key" style="font-size: 16px;">---</p>
                </div>
            </div>
            <div style="background: #222; padding: 20px; border-radius: 12px; border: 1px dashed #444;">
                <p style="color: var(--text-dim);">Selecione uma ferramenta no menu lateral para gerenciar sua plataforma.</p>
            </div>
        </div>

        <div id="tab-gerador" class="adm-section">
            <h2>Gerador de Credenciais</h2>
            <div style="background: #000; padding: 30px; border-radius: 15px; border: 1px solid #333; text-align: center;">
                <div style="display: flex; justify-content: space-around; margin-bottom: 20px;">
                    <div>
                        <small style="color: var(--text-dim);">USU√ÅRIO ATUAL</small>
                        <h3 id="generated-user-v2" style="font-size: 32px; color: var(--accent-blue); margin: 5px 0;">------</h3>
                    </div>
                    <div>
                        <small style="color: var(--text-dim);">CHAVE ATUAL</small>
                        <h3 id="generated-key-v2" style="font-size: 32px; color: var(--accent-blue); margin: 5px 0;">------</h3>
                    </div>
                </div>
                <button class="btn-green" onclick="generateKey()">GERAR NOVAS CREDENCIAIS</button>
                <button id="btn-copy-v2" class="btn-blue" onclick="copyAccess()">COPIAR PARA WHATSAPP</button>
            </div>
        </div>

        <div id="tab-usuarios" class="adm-section">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h2>Usu√°rios Conectados</h2>
                <button class="btn-red" style="width: auto; padding: 8px 20px;" onclick="removerUsuario()">Limpar Base</button>
            </div>
            <div id="user-list-v2" class="data-box" style="height: 300px; border-color: #333;">
                Buscando base de dados...
            </div>
        </div>

        <div id="tab-chat" class="adm-section">
            <h2>Suporte em Tempo Real</h2>
            <div class="chat-container">
                <div id="chat-box-adm-v2"></div>
                <div style="padding: 15px; display: flex; gap: 10px; background: #111;">
                    <input type="text" id="msg-adm-v2" placeholder="Digite a resposta para o membro..." style="margin: 0;">
                    <button class="btn-green" style="width: 120px; margin: 0;" onclick="enviarMsgV2()">ENVIAR</button>
                </div>
            </div>
        </div>

    </div>
</div>

<script>
    // Fun√ß√£o para alternar entre as abas do ADM de forma fluida
    function switchAdmTab(tabId) {
        document.querySelectorAll('.adm-section').forEach(tab => tab.classList.remove('active'));
        document.querySelectorAll('.sidebar-btn').forEach(btn => btn.classList.remove('active'));
        
        document.getElementById(tabId).classList.add('active');
        event.currentTarget.classList.add('active');
    }

    // Sobrescrever/Adicionar fun√ß√µes para atualizar os novos IDs sem quebrar o c√≥digo original
    db.ref('acesso').on('value', (s) => {
        const data = s.val();
        if(data) {
            currentKey = data.chave;
            currentUser = data.usuario;
            // Atualiza os campos na nova interface
            if(document.getElementById('generated-user-v2')) {
                document.getElementById('generated-user-v2').innerText = currentUser;
                document.getElementById('generated-key-v2').innerText = currentKey;
                document.getElementById('stat-last-key').innerText = `User: ${currentUser}`;
            }
        }
    });

    db.ref('usuarios').on('value', (s) => {
        let count = 0;
        let html = "";
        s.forEach(u => { 
            html += `<div style="padding: 10px; border-bottom: 1px solid #222; display: flex; align-items: center; gap: 10px;">
                        <span style="color: #00ff00">‚óè</span> <b>${u.val().nome}</b>
                     </div>`; 
            count++;
        });
        if(document.getElementById('user-list-v2')) {
            document.getElementById('user-list-v2').innerHTML = html || "Nenhum usu√°rio online no momento.";
            document.getElementById('stat-user-count').innerText = count;
        }
    });

    db.ref('mensagens').on('value', (s) => {
        let html = "";
        s.forEach(m => {
            const isAdm = m.val().autor === 'ADM';
            html += `<div class="msg-bubble ${isAdm ? 'msg-adm' : 'msg-membro'}">
                        <small style="display:block; font-size: 10px; opacity: 0.7;">${m.val().autor}</small>
                        ${m.val().texto}
                     </div>`;
        });
        const box = document.getElementById('chat-box-adm-v2');
        if(box) {
            box.innerHTML = html;
            box.scrollTop = box.scrollHeight;
        }
    });

    function enviarMsgV2() {
        const input = document.getElementById('msg-adm-v2');
        const txt = input.value;
        if(txt) {
            db.ref('mensagens').push({ autor: 'ADM', texto: txt });
            input.value = "";
        }
    }

    // Ajuste na fun√ß√£o original de Login para exibir o painel flex
    const originalCheckAdm = checkAdm;
    checkAdm = function() {
        if(document.getElementById('adm-user').value === "1515" && document.getElementById('adm-pass').value === "151") {
            document.querySelectorAll('.screen').forEach(s => s.style.display = 'none');
            const panel = document.getElementById('screen-adm-panel');
            panel.style.display = 'flex'; // Exibe como flex para o layout de sidebar
        } else { alert("Acesso negado!"); }
    };
</script>
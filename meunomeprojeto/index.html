<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KERIX M√çDIA - HUB</title>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <style>
        :root { --primary: #ff0000; --bg: #050505; --card: #121212; --text: #ffffff; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); margin: 0; height: 100vh; overflow: hidden; }
        
        /* PAINEL CENTRAL (HUB) */
        .hub-container { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; gap: 20px; }
        .tool-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; width: 90%; max-width: 400px; }
        .tool-card { background: var(--card); padding: 20px; border-radius: 15px; border: 1px solid #222; text-align: center; cursor: pointer; transition: 0.3s; }
        .tool-card:hover { border-color: var(--primary); transform: translateY(-5px); }

        /* JANELA DE CHAT FLUTUANTE */
        .chat-window { 
            position: fixed; bottom: 20px; right: 20px; width: 350px; height: 500px; 
            background: var(--card); border-radius: 20px; border: 1px solid #333; 
            display: none; flex-direction: column; z-index: 1000; box-shadow: 0 10px 30px rgba(0,0,0,0.8);
        }
        .chat-header { background: #000; padding: 15px; border-radius: 20px 20px 0 0; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #222; }
        
        /* ESTILO WHATSAPP INTERNO */
        .chat-container { flex: 1; overflow-y: auto; padding: 10px; display: flex; flex-direction: column; gap: 8px; background: #080808; }
        .msg { padding: 8px 12px; border-radius: 12px; max-width: 80%; font-size: 13px; }
        .msg-mem { background: #222; align-self: flex-start; }
        .msg-adm { background: #8b0000; align-self: flex-end; }
        
        .input-area { padding: 10px; background: #111; display: flex; gap: 5px; align-items: center; border-radius: 0 0 20px 20px; }
        .input-area textarea { flex: 1; background: #222; border: none; color: #fff; padding: 8px; border-radius: 15px; height: 20px; resize: none; }

        /* LOGIN */
        .login-box { background: var(--card); padding: 30px; border-radius: 20px; border: 1px solid #222; text-align: center; width: 300px; }
        input { width: 100%; padding: 12px; margin: 8px 0; border-radius: 8px; border: 1px solid #333; background: #1a1a1a; color: white; box-sizing: border-box; }
        button { width: 100%; padding: 12px; border-radius: 8px; border: none; cursor: pointer; font-weight: bold; }
        .btn-red { background: var(--primary); color: white; }

        .btn-close { background: none; color: #666; font-size: 20px; width: auto; padding: 0; }
    </style>
</head>
<body>

    <div id="main-hub" class="hub-container">
        <div id="login-screen" class="login-box">
            <h2 style="color:var(--primary)">KERIX LOGIN</h2>
            <input type="text" id="user-in" placeholder="Usu√°rio">
            <input type="password" id="pass-in" placeholder="Senha">
            <button class="btn-red" onclick="autenticar()">ENTRAR</button>
            <p style="font-size: 10px; color: #555; margin-top: 15px;">Dica: Use 123 / 123 para Membro ou 1515 / 151 para ADM</p>
        </div>

        <div id="hub-tools" style="display:none; text-align: center;">
            <h2 id="welcome-msg">Painel de Controle</h2>
            <div class="tool-grid">
                <div class="tool-card" onclick="toggleChat()">üí¨<br>Suporte Chat</div>
                <div class="tool-card" style="opacity: 0.5;">‚öôÔ∏è<br>Em breve</div>
                <div class="tool-card" style="opacity: 0.5;">üìä<br>Em breve</div>
                <div class="tool-card" onclick="location.reload()">üö™<br>Sair</div>
            </div>
        </div>
    </div>

    <div id="chat-window" class="chat-window">
        <div class="chat-header">
            <span id="chat-title">Suporte WhatsApp</span>
            <button class="btn-close" onclick="toggleChat()">‚úï</button>
        </div>
        <div class="chat-container" id="chat-box"></div>
        <div class="input-area">
            <label style="cursor:pointer">üì∑<input type="file" accept="image/*" style="display:none" onchange="sendFile(this, 'img')"></label>
            <button class="btn-close" id="rec-btn" onclick="handleAudio()">üé§</button>
            <textarea id="chat-input" placeholder="Digite aqui..."></textarea>
            <button class="btn-red" style="width:40px; border-radius:50%" onclick="enviar()">‚ûî</button>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyA-uzWKwZ5aW-t40uamPDpHLqx3Yd4ei8g",
            authDomain: "kerix-midia.firebaseapp.com",
            databaseURL: "https://kerix-midia-default-rtdb.firebaseio.com",
            projectId: "kerix-midia",
            storageBucket: "kerix-midia.firebasestorage.app",
            messagingSenderId: "1009939877055",
            appId: "1:1009939877055:web:42b9c88989f9e17cffca0a"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let tipoUsuario = ""; // "ADM" ou "MEMBRO"
        let nomeUsuario = "";
        let mediaRecorder, audioChunks = [];

        function autenticar() {
            const u = document.getElementById('user-in').value;
            const p = document.getElementById('pass-in').value;

            if(u === "1515" && p === "151") {
                tipoUsuario = "ADM"; nomeUsuario = "ADM";
                iniciarHub();
            } else if(u === "123" && p === "123") {
                tipoUsuario = "MEMBRO"; nomeUsuario = "Membro Teste";
                iniciarHub();
            } else { alert("Acesso inv√°lido!"); }
        }

        function iniciarHub() {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('hub-tools').style.display = 'block';
            document.getElementById('welcome-msg').innerText = "Bem-vindo, " + nomeUsuario;
            document.getElementById('chat-title').innerText = tipoUsuario === "ADM" ? "Painel de Respostas" : "Suporte Kerix";
        }

        function toggleChat() {
            const win = document.getElementById('chat-window');
            win.style.display = win.style.display === 'flex' ? 'none' : 'flex';
        }

        // SINCRONIZA√á√ÉO CHAT
        db.ref('mensagens').on('value', s => {
            let h = "";
            s.forEach(m => {
                const d = m.val();
                const isAdm = d.autor === 'ADM';
                h += `<div class="msg ${isAdm ? 'msg-adm' : 'msg-mem'}">
                        <small style="display:block; font-size:9px; opacity:0.6">${d.autor}</small>
                        ${d.texto || ''}
                        ${d.img ? `<img src="${d.img}" style="max-width:100%; border-radius:10px; margin-top:5px">` : ''}
                        ${d.audio ? `<audio src="${d.audio}" controls style="width:100%; filter:invert(1)"></audio>` : ''}
                      </div>`;
            });
            const box = document.getElementById('chat-box');
            box.innerHTML = h;
            box.scrollTop = box.scrollHeight;
        });

        function enviar() {
            const input = document.getElementById('chat-input');
            if(input.value.trim()) {
                db.ref('mensagens').push({ autor: nomeUsuario, texto: input.value });
                input.value = "";
            }
        }

        function sendFile(input, tipo) {
            const reader = new FileReader();
            reader.onload = e => {
                const payload = { autor: nomeUsuario };
                payload[tipo] = e.target.result;
                db.ref('mensagens').push(payload);
            };
            reader.readAsDataURL(input.files[0]);
        }

        async function handleAudio() {
            const btn = document.getElementById('rec-btn');
            if (!mediaRecorder || mediaRecorder.state === "inactive") {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                mediaRecorder = new MediaRecorder(stream);
                mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
                mediaRecorder.onstop = () => {
                    const blob = new Blob(audioChunks, { type: 'audio/webm' });
                    const reader = new FileReader();
                    reader.onload = e => db.ref('mensagens').push({ autor: nomeUsuario, audio: e.target.result });
                    reader.readAsDataURL(blob);
                    audioChunks = [];
                    btn.innerText = "üé§";
                };
                mediaRecorder.start();
                btn.innerText = "üõë";
            } else { mediaRecorder.stop(); }
        }
    </script>
</body>
</html>